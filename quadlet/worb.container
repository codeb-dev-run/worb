# ==============================================================================
# worb CMS - Quadlet Configuration (Production)
# Generated by CodeB CLI v3.3.0
# Date: 2025-12-22
# ==============================================================================
# Environment: production
# Port: 4000
# Domain: worb.codeb.kr
# ==============================================================================
# Infrastructure:
#   - App Server: app.codeb.kr (158.247.203.55)
#   - Database: db.codeb.kr (PostgreSQL 5432)
#   - Redis: db.codeb.kr (Redis 6379)
#   - WebSocket: ws.codeb.kr (Centrifugo 8000)
# ==============================================================================

[Unit]
Description=worb CMS Production
After=network-online.target
Wants=network-online.target

[Container]
Image=ghcr.io/codeb-dev-run/worb:latest
ContainerName=worb
AutoUpdate=registry

# Network mode: host for direct server connections
Network=host

# Core environment
Environment=NODE_ENV=production
Environment=PORT=4000
Environment=HOSTNAME=0.0.0.0

# Database (Storage Server: db.codeb.kr)
Environment=DATABASE_URL=postgresql://worb_user:worb_secure_pass@db.codeb.kr:5432/worb?schema=public

# Redis (Storage Server: db.codeb.kr)
Environment=REDIS_URL=redis://db.codeb.kr:6379/0
Environment=REDIS_PREFIX=worb:

# Centrifugo (Streaming Server: ws.codeb.kr)
Environment=NEXT_PUBLIC_CENTRIFUGO_URL=wss://ws.codeb.kr/connection/websocket
Environment=CENTRIFUGO_URL=wss://ws.codeb.kr/connection/websocket
Environment=CENTRIFUGO_API_URL=http://ws.codeb.kr:8000/api
Environment=CENTRIFUGO_API_KEY=pRMupNs6HlGp7G6xkPsAFrI8hN4g6U0G
Environment=CENTRIFUGO_SECRET=of0KuRFjjzhq5LlBURCuKqzTUAA08hwL

# Secrets from external file
EnvironmentFile=/etc/containers/systemd/worb.env

# Health check
HealthCmd=curl -sf http://localhost:4000/api/health || exit 1
HealthInterval=30s
HealthTimeout=10s
HealthRetries=3
HealthStartPeriod=60s

# Resource limits
PodmanArgs=--memory=2g --cpus=2

[Service]
Restart=always
RestartSec=10s
TimeoutStartSec=300

[Install]
WantedBy=multi-user.target default.target
